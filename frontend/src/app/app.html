<!-- Si NO estÃ¡ logueado: solo mostrar el router (login page) -->
<div *ngIf="!auth.isLoggedIn">
  <router-outlet></router-outlet>
</div>

<!-- Si ESTÃ logueado: mostrar sidebar + contenido -->
<div class="app-container" *ngIf="auth.isLoggedIn">

  <!-- Sidebar Lateral -->
  <aside class="sidebar" [class.active]="menuOpen">
    <div class="sidebar-brand">
      <span>ğŸª Micromercado</span>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item"
        (click)="menuOpen = false">
        ğŸ“Š Dashboard
      </a>

      <a routerLink="/productos" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('productos')"
        (click)="menuOpen = false">
        ğŸ“¦ Productos
      </a>

      <a routerLink="/categorias" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('categorias')"
        (click)="menuOpen = false">
        ğŸ·ï¸ CategorÃ­as
      </a>

      <a routerLink="/ventas" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('ventas')"
        (click)="menuOpen = false">
        ğŸ§¾ Ventas
      </a>

      <a routerLink="/compras" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('compras')"
        (click)="menuOpen = false">
        ğŸ›ï¸ Compras
      </a>

      <a routerLink="/clientes" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('clientes')"
        (click)="menuOpen = false">
        ğŸ§‘â€ğŸ’¼ Clientes
      </a>

      <a routerLink="/movimientos" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('movimientos')"
        (click)="menuOpen = false">
        ğŸ“‹ Movimientos
      </a>

      <a routerLink="/proveedores" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('proveedores')"
        (click)="menuOpen = false">
        ğŸšš Proveedores
      </a>

      <a routerLink="/descuentos" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('descuentos')"
        (click)="menuOpen = false">
        ğŸ·ï¸ Descuentos
      </a>

      <a routerLink="/reportes" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('reportes')"
        (click)="menuOpen = false">
        ğŸ“ˆ Reportes
      </a>

      <a routerLink="/usuarios" routerLinkActive="active" class="nav-item" *ngIf="auth.tieneAcceso('usuarios')"
        (click)="menuOpen = false">
        ğŸ‘¥ Usuarios
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile-mini">
        <div class="role-badge" [ngClass]="{
                    'role-admin': auth.rolNombre === 'Administrador',
                    'role-cajero': auth.rolNombre === 'Cajero',
                    'role-bodeguero': auth.rolNombre === 'Bodeguero'
                }">
          {{ auth.rolNombre }}
        </div>
      </div>
      <p>Â© 2026 Sistema MuÃ±oz</p>
    </div>
  </aside>

  <!-- Contenido Principal -->
  <div class="main-wrapper">

    <!-- Top Header -->
    <header class="top-header">
      <button class="header-toggle" (click)="toggleMenu()">â˜°</button>

      <div class="header-user">
        <!-- Notificaciones -->
        <div class="notif-wrapper">
          <button class="notif-btn" (click)="toggleNotif()" title="Notificaciones">
            ğŸ””
            <span class="notif-badge" *ngIf="notificaciones.length > 0">{{ notificaciones.length }}</span>
          </button>
          <div class="notif-dropdown" *ngIf="notifOpen">
            <div class="notif-header">
              <strong>âš ï¸ Alertas de Stock</strong>
            </div>
            <div *ngIf="notificaciones.length === 0" class="notif-empty">
              âœ… Sin alertas
            </div>
            <div class="notif-list">
              <div *ngFor="let n of notificaciones.slice(0, 8)" class="notif-item">
                <span class="notif-product">{{ n.prodnombre || n.nombre }}</span>
                <span class="notif-stock badge badge-danger">{{ n.prodstock_global || n.stock_actual }} un.</span>
              </div>
            </div>
          </div>
        </div>

        <div class="user-info text-right">
          <span class="user-name">{{ auth.usuario?.usuusuario }}</span>
          <span class="user-role">{{ auth.rolNombre }}</span>
        </div>
        <div class="user-avatar" [ngClass]="{
                    'avatar-admin': auth.rolNombre === 'Administrador',
                    'avatar-cajero': auth.rolNombre === 'Cajero',
                    'avatar-bodeguero': auth.rolNombre === 'Bodeguero'
                }">{{ getIniciales() }}</div>
        <button class="btn-logout" (click)="logout()" title="Cerrar SesiÃ³n">
          ğŸšª
        </button>
      </div>
    </header>

    <!-- Router Outlet -->
    <main class="page-content">
      <router-outlet></router-outlet>
    </main>

  </div>

</div>